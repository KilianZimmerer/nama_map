<!DOCTYPE html>

<html>
  <head>
    <link rel="stylesheet" href="./node_modules/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="map.css" >
    <link rel="stylesheet" href="./node_modules/L.Control.Sidebar.css" />


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="./node_modules/leaflet/dist/leaflet.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  </head>

  <body>
    <div id="sidebar"></div>
    <div id="map"></div>

    <div class="nxt-content">
      <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <a class="navbar-brand" href="https://www.nachbarschaftsmarktplatz.de">
          <img src="./icon-white-1.png" width="50" alt="">
          Nachbarschaftsmarktplatz
        </a>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="#" role="button" data-toggle="modal" data-target="#Modal1"> Shop registrieren </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" role="button" onclick="openInfoSidebar()"> Infos </a>
            </li>
          </ul>
      </nav>
    </div>

    <!-- The Modal 1-->
    <div class="modal" id="Modal1">
      <div class="modal-dialog">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Shop registrieren - Seite 1</h4>
          </div>

          <!-- Modal body 1 -->
          <div class="modal-body">
              <div class="form-group">
                <label for="usr">Name des Geschäfts</label>
                <input type="text" class="form-control" id="usr">
              </div>
              <div class="form-group">
                <label for="usr">Email</label>
                <input type="text" class="form-control" id="usr">
              </div>
              <div class="form-group">
                <label for="usr">Telefon (Unter der Kund*innen euch erreichen können)</label>
                <input type="text" class="form-control" id="usr">
              </div>
              <div class="form-group">
                <label for="usr">Zeiten für telefonische Erreichbarkeit</label>
                <div class="input-append date" id="datetimepicker" data-date="00:00">
                  von
                  <input class="span2" size="12" type="text" value="08:00">
                  <span class="add-on"><i class="icon-th"></i></span> 
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  bis
                  <input class="span2" size="12" type="text" value="20:00">
                  <span class="add-on"><i class="icon-th"></i></span>
              </div>
              </div>
              <button type="button" class="btn btn-primary float-right" onclick="showModal('Modal2')">Weiter</button>
          </div>
        </div>
      </div>
    </div>

    <!-- The Modal 2-->
    <div class="modal" id="Modal2">
      <div class="modal-dialog">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Shop registrieren - Seite 2</h4>
          </div>

          <!-- Modal body 2 -->
          <div class="modal-body">
            <div class="form-group">
              <label for="usr">Beschreibung des Geschäfts (2 Sätze, optional)</label>
              <textarea class="form-control" rows="3" id="comment"></textarea>
            </div>
            <div class="form-group">
              <label for="usr">Webseite</label>
              <input type="text" class="form-control" id="usr">
            </div>
              <div class="form-group">
                <label for="usr">Kategorien</label>
                <input type="text" class="form-control" id="usr">
              </div>
              Bild wählen:
              <input type="file" id="myFile" name="filename2">
              <br> <br>
              <button type="button" class="btn btn-primary float-left" onclick="showModal('Modal1')">Zurück</button>
              <button type="button" class="btn btn-primary float-right">Absenden</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function showModal(id) {
        $(".modal").modal('hide');
        $("#" + id).modal();
      }
    </script>



    <script src="shop_data.js"></script>
    <script src="map.js"></script>
    <script src="./node_modules/L.Control.Sidebar.js"></script>
    <script>
      var sidebar = L.control.sidebar('sidebar', {
            closeButton: false,
            position: 'right',
            autoPan: false,
        });
        map.addControl(sidebar);

      function create_markers(val, idx, array) {
        var sidebarContent = (
          `<div>
            <img src="${val['logo']}" alt="" style="width:250px" class="rounded">
            <br>
            <h3>${val['company_name']}</h3>
            <hr>
            <img src="./location_icon.png" style="width:20px"> ${val['address']}
            <br> <br>
            <img src="./home_icon.png" style="width:20px">  <a href="${val['shop_url']}">online shop</a>
          </div>`
        )
        function onClickMarker(e) {
          if (idx == sidebar.state) {
            sidebar.hide()
            sidebar.state = array.lengths
          } else {
          sidebar.setContent(sidebarContent);
          sidebar.state = idx
          sidebar.show();
          }
        }
        marker = L.marker([val['latitude'], val['longitude']])
        marker.addTo(map);
        marker.on('click', onClickMarker);
      };

      map.on('click', onClickMap);

      function onClickMap(e) {
        if (sidebar.isVisible()) {
          sidebar.hide()
      }
    }

    shop_data.forEach(create_markers)

    function openInfoSidebar() {
      var infosContent = (
        `<div>
          <h2> Infos </h2>
          <hr>
          <h4> Wer wir sind </h4>
          <br>
          <p class="text-justify">
          Wir sind eine wachsende Gruppe von mittlerweile über 40 Menschen (nicht nur) aus Berlin,
          die sich im Rahmen des <a href="https://wirvsvirushackathon.devpost.com/"> WirVsVirus-Hackathons </a> zusammengefunden hat.
          </p>
        </div>`
      )
      sidebar.setContent(infosContent);
      sidebar.toggle();

    }
    </script>
  </body>
</html>

